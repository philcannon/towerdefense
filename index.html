<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phaser Tower Defense</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<script>
class TowerDefenseScene extends Phaser.Scene {
  constructor() {
    super('TowerDefenseScene');
  }

  preload() {
    this.load.image('enemy', 'https://labs.phaser.io/assets/sprites/aliengreen.png');
    this.load.image('tower', 'https://labs.phaser.io/assets/sprites/tank.png');
    this.load.image('bullet', 'https://labs.phaser.io/assets/sprites/bullet.png');
    this.load.image('background', 'https://labs.phaser.io/assets/skies/space3.png');
  }

  create() {
    this.add.image(400, 300, 'background');

    this.towers = this.physics.add.group();
    this.enemies = this.physics.add.group();
    this.bullets = this.physics.add.group();

    this.input.on('pointerdown', (pointer) => {
      this.towers.create(pointer.x, pointer.y, 'tower').setScale(0.5);
    });

    this.time.addEvent({
      delay: 1000,
      callback: this.spawnEnemy,
      callbackScope: this,
      loop: true
    });

    this.physics.add.overlap(this.bullets, this.enemies, this.hitEnemy, null, this);
  }

  spawnEnemy() {
    const enemy = this.enemies.create(0, Phaser.Math.Between(100, 500), 'enemy').setScale(0.5);
    enemy.setVelocityX(50);
  }

  hitEnemy(bullet, enemy) {
    bullet.destroy();
    enemy.destroy();
  }

  update(time, delta) {
    this.towers.children.iterate((tower) => {
      const enemy = this.physics.closest(tower, this.enemies.getChildren());
      if (enemy && Phaser.Math.Distance.Between(tower.x, tower.y, enemy.x, enemy.y) < 150) {
        if (!tower.lastFired || time > tower.lastFired + 500) {
          const bullet = this.bullets.create(tower.x, tower.y, 'bullet').setScale(0.5);
          this.physics.moveTo(bullet, enemy.x, enemy.y, 300);
          tower.lastFired = time;
        }
      }
    });
  }
}

const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  scene: TowerDefenseScene,
  physics: {
    default: 'arcade',
    arcade: {
      debug: false
    }
  }
};

new Phaser.Game(config);
</script>
</body>
</html>
